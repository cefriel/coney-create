<style>
  mat-form-field{
    width: 100%;
  }
</style>
<div *ngIf="!isBeingConfirmed" class="row justify-content-center">

  <div class="row m-0" style="position: relative;">
    <h3 class="pl-3">Translation  <small style="color: gray;">
      <b *ngIf="defaultlanguage!=undefined" class="px-2">{{defaultlanguage.tag}}</b> {{conversationTitle}}</small></h3>
    
   
    <button *ngIf="!displayUpload" mat-raised-button color="primary" (click)="displayUpload = true" style="position: absolute; right: 1.5rem; top:-.5rem;">Upload CSV</button>
    <button *ngIf="displayUpload" mat-raised-button color="primary" (click)="displayUpload = false" style="position: absolute; right: 1.5rem; top:-.5rem;">Display Languages</button>

    <button mat-raised-button [matMenuTriggerFor]="menu" color="primary" 
    style="position: absolute; right: 1.5rem; top: 2rem; background-color: green;">+ Translation</button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="downloadCSV('display', language.tag)" *ngFor="let language of languages"
      >{{language.lang}}</button>
    </mat-menu>
  </div>
<div class="row pl-3 pb-1">
  <mat-chip-list aria-label="languages">
    <mat-chip *ngFor="let language of availableLanguages" style="cursor: pointer;" (click)="downloadCSV('display', language.tag)">{{language.lang}}</mat-chip>
  </mat-chip-list>
</div>

<div class="row" *ngIf="languageInTranslation != undefined">
  <hr *ngIf="!isLoading && !emptyFields" style="width: 40%;">
  <h5 *ngIf="!isLoading" style="width:20%; text-align: center; font-weight: 500;" class="m-0 pt-2">{{activeLanguage}}</h5>
  <hr *ngIf="!isLoading && !emptyFields" style="width: 40%;">
  <div class="col-3">
    <h6 class="m-0" style="padding-top: 1rem!important; color: gray;">Translated title:</h6></div>
  <div class="col-9">
    <mat-form-field style="width: 100%;">
    <input matInput placeholder="TITLE" [(ngModel)]="activeTitle">
  </mat-form-field></div>
</div>



<div class="row" *ngIf="languageInTranslation != undefined">
  <div class="col-5">
    <h6 class="m-0 pb-2" style="color: gray;">Messages: </h6></div>
</div>

  <p *ngIf="!isLoading && emptyFields" style="width: 100%; color: red;" class="pt-1 m-4 text-center">{{errorMessage}}
  </p>
  <mat-progress-bar *ngIf="isLoading && !emptyFields" style="widows: 80%" mode="indeterminate"></mat-progress-bar>

  <div class="container-fluid px-0" *ngIf="!displayUpload" style="max-height: 47vh; overflow-y: auto;">
   


    <div *ngFor="let item of activeData" class="row pt-3" style="border-bottom: 1px solid #2d3c7621;">
      <div class="col-2 pt-3">{{item.type}}</div>
      <div class="col-5 py-3" style="word-break: break-word;">{{item.text}}</div>
      <div class="col-5">
        <mat-form-field>
          <textarea matInput placeholder="translation" [(ngModel)]="item.translation"></textarea>
        </mat-form-field>
      </div>
    </div>
  </div>


  <div class="row justify-content-between pt-4 px-0 " *ngIf="!displayUpload && languageInTranslation != undefined">
    <div *ngIf="updateSuccessful" class="col-12" style="color: green">
      <h6 style="width: 100%; text-align: right">Update Successful!</h6>
    </div>
    <button mat-stroked-button (click)="downloadCSV('save', undefined)">Download <i>{{languageInTranslation}}</i> translation CSV</button>
    <button mat-raised-button color="accent" (click)="updateTranslation()">UPDATE</button>
  </div>


  
  <!--UPLOAD-->
  <div class="container-fluid" *ngIf="displayUpload">
    <div class="row m-0 text-center justify-content-center">
      <mat-form-field style="line-height: 1.5;">
        <input matInput type="text" placeholder="Translated Title" [(ngModel)]="translatedTitle"
          [ngModelOptions]="{standalone: true}">
      </mat-form-field>

    </div>

    <div class="row m-0 text-center justify-content-center">
      <mat-form-field style="line-height: 1.5;">
        <mat-label>Language</mat-label>
        <mat-select [(value)]="selectedLanguage" (selectionChange)="selectSelChanged()">
          <mat-option *ngFor="let i of languages" [value]="i">
            {{i.lang}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <input #fileImportInput [disabled]="selectedLanguage == undefined || selectedLanguage.lang==''" type="file"
        class="mt-2 mb-4" id="file" (change)="fileChangeListener($event)" accept=".csv">
    </div>

    <br>
    <button mat-raised-button [disabled]="!uploadButtonEnabled" color="primary" (click)="uploadCSV()">Upload translation
      CSV</button>

  </div>

</div>

<div *ngIf="isBeingConfirmed" class="row justify-content-center">
  <div class="row m-0 text-center justify-content-center">
    <h6 class="mb-4">You are uploading the <span style="font-weight: 500;">{{selectedLanguage.lang}}</span> translation
    </h6>

  </div>
  <div class="row m-0 text-center justify-content-center">
   
    <mat-progress-bar *ngIf="isLoading" style="width:100%" mode="indeterminate"></mat-progress-bar>
    <button mat-button color="primary" (click)="goBack()">EDIT</button>
    <button mat-raised-button color="primary" (click)="sendData()">UPLOAD</button>
  </div>
</div>